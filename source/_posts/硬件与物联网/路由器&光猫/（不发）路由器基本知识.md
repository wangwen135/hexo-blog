---
title: （不发）路由器基本知识
date: 2021-09-09 23:41
tags: 
  - 路由器&光猫
categories:
  - [硬件与物联网, 路由器&光猫]
---

**到底从哪里复制的不记得了**
**不发了**


## 基本组成

路由里有CPU、Flash和内存(RAM)，他们分别类似对应电脑的CPU、硬盘和内存。

Flash中存储的内容大致可以分为三部分，分别是bootloader、固件和EEPROM。

### bootloader
bootloader：类似电脑中的BIOS功能，当路由开机启动时首先运行的就是bootloader，由它分配内存地址，并将固件加载到内存中运行，bootloader有很多种，uboot和breed都属于bootloader。

### 固件
固件：类似于电脑的系统，和电脑系统一样，固件也分许多种，openwrt、dd等等都是固件。厂商的许多固件也可能包含bootloader，如果包含，在刷机时就会覆盖掉原来的bootloader，除非在bootloader下刷机，例如在breed下刷机，breed就会忽略掉固件包含的bootloader。

### EEPROM
EEPROM：路由信号校验数据，每个路由唯一，各路由间不通用，非常重要，一旦丢失，影响路由无线信号质量，其中Atheros的ART就属于EEPROM的一种，貌似Atheros同种芯片的ART可以通用。

### 编程器
编程器：整个路由器之外的东西，当路由器刷坏变砖的时候，用来烧录路由器的Flash，说白了就是用来重新往路由器中写入bootloader、固件和EEPROM的硬件设备。

### 编程器固件
编程器固件：我个人的理解就是包含bootloader、固件和EEPROM的固件，一般是利用编程器往Flash烧录时使用。

### GPIO
GPIO：可以理解为bootloader或者固件识别的路由器按键代号，路由器一般只有reset按键和wps按键，有的是分开的，有的是二合一的。如果设置错误，会导致按键在bootloader中或者固件中不起作用，或者说按键达不到预期的功能。例如：如果你的路由器的reset按键的GPIO值在breed中为2，你却刷入了breed-mt7620-reset1.bin这个breed，那么你的路由器想要通过reset按键方式就可能进入不了breed，必须重新刷入正确的breed（breed-mt7620-reset2.bin）才可以。


## 刷机

### 常用刷机命令
```
mtd -r write /tmp/breed-mt7620-phicomm-psg1208.bin Bootloader

cat k3_v14.bin > /dev/mtdblock6 && reboot

dd if=/tmp/k2p_bcm_v10.bin of=/dev/mtdblock1 && reboot
```
dd和cat还被用于备份固件。在备份 rom分区的时候，dd和cat得到的结果会不一样，内容排序不同，或者是填充的值不一样，但实质内容是相同的。


### 1.【查看当前系统分区信息】 
```
cat /proc/mtd 
```

### 2.【备份固件firmware】
```
dd if=/dev/mtd2 of=/tmp/firmware_backup.bin 
```
然后用winscp登陆路由器tmp目录，将固件文件firmware_backup.bin保存到电脑中。

> dd是一个Unix和类Unix系统上的命令，主要功能为转换和复制文件。  
> 如：.将/dev/hdb全盘数据备份到指定路径的image文件  
> dd if=/dev/hdb of=/root/image  
> 将备份文件恢复到指定盘  
> dd if=/root/image of=/dev/hdb  

### 3.【恢复固件firmware】
先用winscp将固件文件firmware_backup.bin传至路由器tmp目录,然后： 
```
mtd -r write /tmp/firmware_backup.bin firmware 
```

### 4.【备份恢复Openwrt路由器配置】
```
dd if=/dev/mtd5 of=/tmp/overlay.bin
```
先用winscp将备份文件overlay.bin传至路由器tmp目录,然后： 
```
mtd -r write /tmp/overlay.bin rootfs_data
sysupgrade -b /tmp/back.tar.gz
sysupgrade -b /tmp/back.tar.gz
```

### 5.【恢复Openwrt路由器默认设置】
```
rm -rvf /overlay/* && reboot
mtd -r erase rootfs_data
```
